<!DOCTYPE html>
<html>

<head>
	<title>Bootstrap 3 Template</title>
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<!-- Bootstrap core CSS -->
	<link href="node_modules/bootstrap/dist/css/bootstrap.min.css" rel="stylesheet">

	<!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
	<!--[if lt IE 9]>
      <script src="http://cdnjs.cloudflare.com/ajax/libs/html5shiv/3.7.2/html5shiv.js"></script>
      <script src="http://cdnjs.cloudflare.com/ajax/libs/respond.js/1.4.2/respond.js"></script>
    <![endif]-->
	<style>
		.insight-container {
			border: 1px dotted #999;
			min-height: 50px;
			margin: 10px;
			padding: 5px;
		}

		.scrolable-areaX {
			height: 150px;
			overflow-y: scroll;
		}
	</style>
</head>

<body>
	<div class="container">

		<main class="starter-template">
			<h1>Bootstrap starter template</h1>
			<div class="card-group" id="accordion"></div>
			
			<button id="btn_flicker_issue" class="btn btn-primary btn-lg">UI Flicker Issue</button>
			<br><br>
			<div id="msg_div" class="alert alert-info d-none">Testing JavaScript Issue</div>
		</main>

	</div>
	<!-- /.container -->

	<!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
	<script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN"
	 crossorigin="anonymous"></script>
	<script>window.jQuery || document.write('<script src="node_modules/jquery/dist/jquery.slim.min.js"><\/script>')</script>
	<script src="node_modules/popper.js/dist/umd/popper.min.js"></script>
	<script src="node_modules/bootstrap/dist/js/bootstrap.min.js"></script>
</body>

</html>



<script>
	$(function(){
		$("#btn_flicker_issue").on("focus click mouseenter hover",function(e){
			console.log(e.type);
			var msg = $("#msg_div");
			/*if(msg.hasClass("d-none")){
				msg.removeClass("d-none");
			}else{
				msg.addClass("d-none");
			}*/
			msg.removeClass("d-none");
		});
		
		$("#btn_flicker_issue").on("focusout mouseleave",function(e){
			console.log(e.type);
			var msg = $("#msg_div");
			/*if(msg.hasClass("d-none")){
				msg.removeClass("d-none");
			}else{
				msg.addClass("d-none");
			}*/
			msg.addClass("d-none");
		});
		function displayMsg(){
			$("#msg_div").removeClass("d-none");
		}
		function HideMsg(){
			$("#msg_div").removeClass("d-none");
		}
	});
	
	function convertServerDateToLocal(dateInput) {
		var offset = 5.0;
		// var offset = new Date().getTimezoneOffset();
		serverDate = new Date(dateInput);
		utc = serverDate.getTime() - (serverDate.getTimezoneOffset() * 60000);
		clientDate = new Date(utc + (3600000 * offset));

		return clientDate.toLocaleString();
	}

	var mockResponse = [

		{ "id": "501f4bcb-bfa8-4296-b0a6-1a86c8a25f0d", "insightId": "UpdateMobile", "useCaseId": "UpdateMobile_UC1", "generatedDate": "2017-09-10T04:23:59.646Z", "presentedDate": "2017-11-20T07:08:26Z", "selectedDate": "2017-09-12T03:23:49.296Z", "score": 1, "category1": "Take action", "category2": "", "category3": "", "insightType": "STORY", "status": "read", "type": "Take action", "highlighted": true, "teaserTemplate": "image", "teaserBlocks": [{ "blockId": "icon", "type": "image", "url": "AccountInfo.svg", "alt": "Account Information", "isAbsoluteURL": false, "absUrl": "account_info" }, { "blockId": "date", "type": "date-box", "date": "2017-09-10T04:24:22.437Z", "month": "Sep", "day": "09" }, { "blockId": "title", "type": "txt", "text": "Update Information1" }, { "blockId": "teaser-text", "type": "txt", "text": "Please provide your mobile number." }, { "blockId": "main-image", "type": "image", "url": "Citi_Missing_Info", "alt": "Citi_Missing_Info", "isAbsoluteURL": false, "absUrl": "Citi_Missing_Info" }] },

		{ "id": "501f4bcb-bfa8-4296-b0a6-1a86c8a25f0d", "insightId": "UpdateMobile", "useCaseId": "UpdateMobile_UC1", "generatedDate": "2017-08-10T04:23:59.646Z", "presentedDate": "2017-11-20T07:08:26Z", "selectedDate": "2017-08-12T03:23:49.296Z", "score": 1, "category1": "Take action", "category2": "", "category3": "", "insightType": "STORY", "status": "read", "type": "Take action", "highlighted": true, "teaserTemplate": "image", "teaserBlocks": [{ "blockId": "icon", "type": "image", "url": "AccountInfo.svg", "alt": "Account Information", "isAbsoluteURL": false, "absUrl": "account_info" }, { "blockId": "date", "type": "date-box", "date": "2017-08-10T04:24:22.437Z", "month": "Aug", "day": "08" }, { "blockId": "title", "type": "txt", "text": "Update Information2" }, { "blockId": "teaser-text", "type": "txt", "text": "Please provide your mobile number." }, { "blockId": "main-image", "type": "image", "url": "Citi_Missing_Info", "alt": "Citi_Missing_Info", "isAbsoluteURL": false, "absUrl": "Citi_Missing_Info" }] },


		{ "id": "501f4bcb-bfa8-4296-b0a6-1a86c8a25f0f", "insightId": "UpdateMobile", "useCaseId": "UpdateMobile_UC1", "generatedDate": "2017-09-10T04:23:59.646Z", "presentedDate": "2017-11-20T07:08:26Z", "selectedDate": "2017-09-12T03:23:49.296Z", "score": 1, "category1": "Take action", "category2": "", "category3": "", "insightType": "STORY", "status": "read", "type": "Take action", "highlighted": true, "teaserTemplate": "image", "teaserBlocks": [{ "blockId": "icon", "type": "image", "url": "AccountInfo.svg", "alt": "Account Information", "isAbsoluteURL": false, "absUrl": "account_info" }, { "blockId": "date", "type": "date-box", "date": "2017-09-10T04:24:22.437Z", "month": "Sep", "day": "09" }, { "blockId": "title", "type": "txt", "text": "Update Information3" }, { "blockId": "teaser-text", "type": "txt", "text": "Please provide your mobile number." }, { "blockId": "main-image", "type": "image", "url": "Citi_Missing_Info", "alt": "Citi_Missing_Info", "isAbsoluteURL": false, "absUrl": "Citi_Missing_Info" }] },

		{ "id": "501f4bcb-bfa8-4296-b0a6-1a86c8a25f0g", "insightId": "UpdateMobile", "useCaseId": "UpdateMobile_UC1", "generatedDate": "2017-09-10T04:23:59.646Z", "presentedDate": "2017-11-20T07:08:26Z", "selectedDate": "2017-09-12T03:23:49.296Z", "score": 1, "category1": "Take action", "category2": "", "category3": "", "insightType": "STORY", "status": "read", "type": "Take action", "highlighted": true, "teaserTemplate": "image", "teaserBlocks": [{ "blockId": "icon", "type": "image", "url": "AccountInfo.svg", "alt": "Account Information", "isAbsoluteURL": false, "absUrl": "account_info" }, { "blockId": "date", "type": "date-box", "date": "2017-09-10T04:24:22.437Z", "month": "Sep", "day": "09" }, { "blockId": "title", "type": "txt", "text": "Update Information4" }, { "blockId": "teaser-text", "type": "txt", "text": "Please provide your mobile number." }, { "blockId": "main-image", "type": "image", "url": "Citi_Missing_Info", "alt": "Citi_Missing_Info", "isAbsoluteURL": false, "absUrl": "Citi_Missing_Info" }] }


	];


	var getInsightsResponse = mockResponse;
	var grouppedInsightResponse = {};

	$.each(getInsightsResponse, function (index, insight) {
		if (insight.generatedDate != '' && insight.generatedDate != undefined) {
			var generateDate = convertServerDateToLocal(insight.generatedDate);
			//console.log(index+'==>'+generateDate);
			grouppedInsightResponse[insight.generatedDate] = grouppedInsightResponse[insight.generatedDate] || [];
			grouppedInsightResponse[insight.generatedDate].push(insight);
		}
	});


	//console.log(grouppedInsightResponse);

	var html = '';
	var outerCount = 0;
	$.each(grouppedInsightResponse, function (genDate, insight) {
		console.log(insight);
		var generateDate = convertServerDateToLocal(genDate);
		html += '<div class="card">';
		html += '<div class="card-header">';
		html += '<h4 class="card-title">';
		html += '<a data-toggle="collapse" data-parent="#accordion" href="#collapse' + outerCount + '">' + generateDate + '</a>';
		html += '</h4>';
		html += '</div>';
		html += '<div id="collapse' + outerCount + '" class="card-collapse collapse in">';
		html += '<div class="card-body scrolable-area">';
		$.each(insight, function (index, insightObj) {
			console.log(pol = insightObj);
			html += '<div class="insight-container" id="' + insightObj.id + '">';
			html += '<h4>' + insightObj.teaserBlocks[2].text + '</h4>';
			html += '<a href="https://www.google.com" id="linkLoop" class="unlinkAnchor" onclick="">Unlink</a>';
			html += '</div>';
		});
		html += '</div>';
		html += '</div>';
		html += '</div>';
		outerCount++;
	});

	$("#accordion").html(html);


	$('.unlinkAnchor').on('click', function (e) {
		e.preventDefault();
		$(this).attr('href', 'http://www.citi.com');
		var conf = confirm("Confirm?");
		if (conf == true) {
			window.location.href = $(this).attr('href');
		}
	})


</script>